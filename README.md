# LOE CORE

Contains the base code for interactions with LOE database and file file system.

## Setup

Assumes the existence of a mysql database named

```
LOE
```

With tables:

```
anime
comics
docs
movies
music
tv
```

Connection details can be modified in:

```
Libs/Record/Db/credentials.php
```

Expects LOE file system be be mounted at webroot.
Default webroot, is

```
/var/www/html
```

defined in

```
./LoeBase.php
LoeBase::WEBROOT
```

### Structure

Libs/ -- required submodules

 * [./Libs/MessageClient/MessageClient](https://github.com/outlawdesigns-io/MessageClient) - used to email reports generated by Scanner/Processor classes
 * [./Libs/Mp3Reader/Mp3Reader](https://github.com/outlawdesigns-io/Mp3Reader) -   required for a ```\LOE\Song``` to be able to read/write the ID3 tags associated with its file_path
 * [./Libs/Record/Record](https://github.com/outlawdesigns-io/Record) - Extended to create ```\LOE\LoeBase``` which is extended to create domain objects

Models/ -- domain object concrete classes

```
$movie = new \LOE\Movie();
$movie->title = "Titanic";
$movie->director = "James Cameron";
$movie->file_path = \LoeBase::WEBROOT . "/LOE/Video/Movies/Titanic/movie.mp4";
try{
  $movie->create();
}catch(\Exception $e){
  //note that all LOE exceptions will be from the \ namespace
  echo $e->getMessage();
}

// Alternatively

$std = new stdClass();
$std->title = "Titanic";
$std->director = "James Cameron";
$std->file_path = \LoeBase::WEBROOT . "/LOE/Video/Movies/Titanic/movie.mp4";
$movie = new \LOE\Movie();
try{
  $movie->setFields($std)->create();
}catch(\Exception $e){
  echo $e->getMessage();
}

/*
Note that updates work the in the same manner
With two notable differences:
  1: Your object will have been created with an id
  2: You will replace "create()" with "update()"
*/

$movie = new \LOE\Movie(12);
try{
  $movie->setFields($std)->update();
}catch(\Exception $e){
  echo $e->getMessage();
}

/*
Note that all domain objects will function the same way.
*/

$song = new \LOE\Song();
$episode = new \LOE\Episode();
$anime = new \LOE\Anime();
$doc = new \LOE\Doc();


```

Scanners/ -- classes that verify data and produce reports, but do not change the state of any data

```
/*
Scanners can be run independently with $msgTo and $autToken parameters to email a report
They can also be constructed with null parameters and used in larger scripts.
*/
$msgTo = "reportRecipient@mydomain.org";
$token = \LOE\Music\FsHealthScanner::authenticate("username","password")->token;
try{
  $scanner = new \LOE\Music\FsHealthScanner($msgTo,$token);
  print_r($scanner->msgResponse);
}catch(\Exception $e){
  echo $e->getmEssage();
}

//Alternatively

$scanner = new \LOE\Music\FsHealthScanner();
foreach($scanner->missing as $absolutePath){
  //todo something with $absolutePath;
}
```

Processors/ -- classes that verify data and attempt, in some way, to change to state of that data

```
/*
Processors can be run independently with $msgTo and $autToken parameters to email a report
They can also be constructed with null parameters and used in larger scripts.
*/

$msgTo = "reportRecipient@mydomain.org";
$token = \LOE\Music\AutoCovers::authenticate("username","password")->token;
try{
  $scanner = new \LOE\Music\AutoCovers($msgTo,$token);
  print_r($scanner->msgResponse);
}catch(\Exception $e){
  echo $e->getmEssage();
}

//Alternatively

$scanner = new \LOE\Music\FsHealthScanner();
$scanner->autoFix();
foreach($scanner->fixedDirs as $fixedDir){
  //todo something with fixedDir
}

```



## Usage

```
require_once __DIR__ . '/factory.php';

//initialize an empty domain object

$movie = LoeFactory::create('movies');

$movie->title = 'Titanic';

//initialize an existing domain object

$song = LoeFactory::create('music',6661);
print_r($song);

```
